{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js","webpack:///./node_modules/@arcgis/core/layers/graphics/sources/support/clientSideDefaults.js"],"names":["q","Set","I","super","arguments","this","type","e","t","signal","addResolvingPromise","_fetchService","capabilities","query","supportsFormatPBF","parsedUrl","r","dynamicDataSource","a","gdbVersion","s","spatialReference","o","fieldsIndex","i","layer","u","url","path","format","sourceSpatialReference","load","attributes","objectIdField","_getLayerRequestOptions","_getFormDataForAttachment","body","_createFeatureEditResult","data","addAttachmentResult","_createAttachmentErrorResult","attachmentId","updateAttachmentResult","addFeatures","map","_serializeFeature","updateFeatures","_getFeatureIds","deleteFeatures","deleteAttachments","addAttachments","push","_serializeAttachment","updateAttachments","n","length","adds","updates","deletes","l","method","JSON","stringify","join","rollbackOnFailure","rollbackOnFailureEnabled","useGlobalIds","globalIdUsed","attachments","d","_createEditsResult","attachmentIds","deleteAttachmentResults","then","returnUpdates","layerId","id","extent","fullExtent","timeExtent","fromJSON","start","end","get","objectIds","parentObjectId","attachmentInfos","queryTask","executeAttachmentQuery","execute","customParameters","executeJSON","executeForIds","executeForCount","executeForExtent","executeRelationshipQuery","executeRelationshipQueryForCount","sourceJSON","returnAdvancedSymbols","_patchServiceJSON","has","geometryType","drawingInfo","renderer","defaultSymbol","geometry","toJSON","feature","attachment","globalId","name","contentType","uploadId","parentGlobalId","globalIdField","async","FileReader","readAsDataURL","onload","result","onerror","mediaType","File","_getIdsFromFeatureIdentifier","_getIdsFromFeatures","objectId","addFeatureResults","addResults","updateFeatureResults","updateResults","deleteFeatureResults","deleteResults","addAttachmentResults","updateAttachmentResults","success","error","code","description","details","messages","message","httpStatus","messageCode","FormData","elements","set","append","source","f","responseType","prototype","constructOnly","readOnly","dependsOn","_","symbol","indexOf","Function"],"mappings":"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","file":"js/chunk-9ca80934.d171b92f.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/has.js\";import{fixJson as r}from\"../../../core/lang.js\";import{setDeepValue as a}from\"../../../core/object.js\";import{isSome as s,isNone as o}from\"../../../core/maybe.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as u}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../core/Error.js\";import{dataComponents as l}from\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{resolve as d,all as c,create as h}from\"../../../core/promiseUtils.js\";import y from\"../../../geometry/Extent.js\";import p from\"../../../request.js\";import m from\"../../../core/Loadable.js\";import f from\"../../../TimeExtent.js\";import{unapplyEditsZUnitScaling as g}from\"../../../tasks/operations/zscale.js\";import{processAttachmentQueryResult as b}from\"../../../tasks/operations/queryAttachments.js\";import F from\"../../../tasks/QueryTask.js\";import{createDrawingInfo as R}from\"./support/clientSideDefaults.js\";const q=new Set([\"Feature Layer\",\"Table\"]);let I=class extends m{constructor(){super(...arguments),this.type=\"feature-layer\"}load(e){const t=s(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),d(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:r,dynamicDataSource:a,gdbVersion:s,spatialReference:o,fieldsIndex:i}=this.layer,u=t(\"featurelayer-pbf\")&&e?\"pbf\":\"json\";return new F({url:r.path,format:u,fieldsIndex:i,dynamicDataSource:a,gdbVersion:s,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+r+\"/addAttachment\",s=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,s.query);try{const e=await p(a,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}async updateAttachment(e,t,r){await this.load();const a=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+\"/\"+a+\"/updateAttachment\",o=this._getLayerRequestOptions({query:{attachmentId:t}}),i=this._getFormDataForAttachment(r,o.query);try{const e=await p(s,{body:i});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(a,e)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),a=e.updateFeatures.map(this._serializeFeature,this),s=this._getFeatureIds(e.deleteFeatures);g(r,a,this.layer.spatialReference);const o=[],i=[],u=[...e.deleteAttachments];for(const t of e.addAttachments)o.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)i.push(await this._serializeAttachment(t));const n=o.length||i.length||u.length?{adds:o,updates:i,deletes:u}:null,l=this._getLayerRequestOptions({method:\"post\",query:{adds:r.length?JSON.stringify(r):null,updates:a.length?JSON.stringify(a):null,deletes:s.length?s.join(\",\"):null,gdbVersion:null==t?void 0:t.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:n&&JSON.stringify(n)}}),d=await p(this.layer.parsedUrl.path+\"/applyEdits\",l);return this._createEditsResult(d)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+r+\"/deleteAttachments\";try{return(await p(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(\",\")},method:\"post\"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:a}=this.layer,{data:s}=await p(`${a}/${r}`,t),{id:o,extent:i,fullExtent:u,timeExtent:n}=s,l=i||u;return{id:o,fullExtent:l&&y.fromJSON(l),timeExtent:n&&f.fromJSON({start:n[0],end:n[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,a=r.path;await this.load();const s=this._getLayerRequestOptions(t);if(!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")){const{objectIds:t}=e,r=[];for(const e of t){const t=a+\"/\"+e+\"/attachments\";r.push(p(t,s))}return c(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>b(e,a)))}return this.queryTask.executeAttachmentQuery(e,s)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async _fetchService(e){let r=this.layer.sourceJSON;if(!r){const{data:a}=await p(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:t(\"featurelayer-advanced-symbols\")?{returnAdvancedSymbols:!0}:{},signal:e}));r=a}this.sourceJSON=this._patchServiceJSON(r);const a=r.type;if(!q.has(a))throw new n(\"feature-layer-source:unsupported-type\",`Source type \"${a}\" is not supported`)}_patchServiceJSON(e){var t;if(\"Table\"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=R(e.geometryType).renderer;a(\"drawingInfo.renderer\",t,e)}return e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return o(t)?{attributes:r}:\"mesh\"===t.type||\"extent\"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:a,name:s,contentType:o,data:i,uploadId:u}=r,n={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(n.parentGlobalId=\"attributes\"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),u)n.uploadId=u;else if(i){const e=await async function(e){if(\"string\"==typeof e){return l(e)||{data:e}}return h(((t,r)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(l(a.result)),a.onerror=e=>r(e)}))}(i);n.contentType=e.mediaType,n.data=e.data,i instanceof File&&(n.name=i.name)}return s&&(n.name=s),o&&(n.contentType=o),n}_getFeatureIds(e){const t=e[0];return t?\"objectId\"in t?this._getIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_getIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new n(\"feature-layer-source:edit-failure\",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,a=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new n(\"feature-layer-source:attachment-failure\",r,{code:a})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const a=t[e];null!=a&&(r.set?r.set(e,a):r.append(e,a))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:a,dynamicDataSource:s}=this.layer;return{...e,query:r({gdbVersion:a,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:\"json\",...this.layer.customParameters,...null==e?void 0:e.query}),responseType:\"json\"}}};e([i()],I.prototype,\"type\",void 0),e([i({constructOnly:!0})],I.prototype,\"layer\",void 0),e([i({readOnly:!0,dependsOn:[\"layer.parsedUrl\",\"layer.gdbVersion\",\"layer.dynamicDataSource\",\"layer.fieldsIndex\"]})],I.prototype,\"queryTask\",null),I=e([u(\"esri.layers.graphics.sources.FeatureLayerSource\")],I);var _=I;export default _;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/has.js\";import{clone as r}from\"../../../../core/lang.js\";import{defaultPointSymbolJSON as e,defaultPolylineSymbolJSON as n,defaultPolygonSymbolJSON as o}from\"../../../../symbols/support/defaultsJSON.js\";function i(t){return{renderer:{type:\"simple\",symbol:\"esriGeometryPoint\"===t||\"esriGeometryMultipoint\"===t?e:\"esriGeometryPolyline\"===t?n:o}}}function s(r,e){if(t(\"csp-restrictions\"))return()=>({[e]:null,...r});try{let t=`this.${e} = null;`;for(const e in r){t+=`this${e.indexOf(\".\")?`[\"${e}\"]`:`.${e}`} = ${JSON.stringify(r[e])};`}const n=new Function(t);return()=>new n}catch(t){return()=>({[e]:null,...r})}}function u(t={}){return[{name:\"New Feature\",description:\"\",prototype:{attributes:r(t)}}]}export{s as createDefaultAttributesFunction,u as createDefaultTemplate,i as createDrawingInfo};\n"],"sourceRoot":""}