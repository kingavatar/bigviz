{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/layers/graphics/sources/support/MemorySourceWorker.js","webpack:///./node_modules/@arcgis/core/layers/graphics/sources/support/sourceUtils.js","webpack:///./node_modules/@arcgis/core/layers/graphics/data/BoundsStore.js","webpack:///./node_modules/@arcgis/core/layers/graphics/data/optimizedFeatureQueryEngineAdapter.js","webpack:///./node_modules/@arcgis/core/layers/graphics/data/FeatureStore.js"],"names":["E","x","xmin","ymin","xmax","ymax","spatialReference","T","hasAttachments","capabilities","useStandardizedQueries","supportsCoordinatesQuantization","supportsReturningQueryGeometry","advancedQueryCapabilities","supportsQueryAttachments","supportsStatistics","supportsPercentileStatistics","supportsReturningGeometryCentroid","supportsQueryWithDistance","supportsDistinct","supportsReturningQueryExtent","supportsReturningGeometryProperties","supportsHavingClause","supportsOrderBy","supportsPagination","supportsQueryWithResultType","supportsSqlExpression","supportsDisjointSpatialRel","q","e","z","hasZ","R","m","hasM","this","_queryEngine","_nextObjectId","destroy","_requiredFields","_fieldsIndex","_createDefaultAttributes","t","i","features","s","r","_inferLayerProperties","fields","l","o","d","f","I","b","F","geometryType","_","j","objectIdField","timeInfo","push","name","message","some","type","editable","nullable","unshift","alias","field","jsonValues","indexOf","startTimeField","get","endTimeField","trackIdField","details","D","warnings","featureErrors","layerDefinition","drawingInfo","templates","extent","assignedObjectIds","featureStore","length","O","reduce","attributes","isNaN","isFinite","Math","max","_loadInitialFeatures","adds","updates","_applyEdits","executeQuery","signal","executeQueryForCount","executeQueryForIds","executeQueryForExtent","n","a","geometry","toLowerCase","u","uid","_assignObjectId","addMany","fullExtent","start","end","timeExtent","deletes","addResults","deleteResults","updateResults","uidToObjectId","_applyAddEdits","_applyUpdateEdits","removeManyById","featureEditResults","p","y","c","has","getFeature","add","code","description","error","globalId","objectId","success","uniqueId","Set","clear","originalValue","sanitizedValue","parseFloat","String","h","TypeError","simplify","async","g","minX","minY","maxX","maxY","_indexInvalid","_boundsToLoad","_boundsById","Map","_idByBounds","_index","_loadIndex","Array","size","forEach","load","filter","delete","remove","search","set","getObjectId","getAttributes","getAttribute","cloneWithGeometry","getGeometry","getCentroid","centroid","geometryInfo","_boundsStore","_featuresById","_markedIds","events","featureAdapter","numFeatures","min","coords","featureCount","vertexCount","_add","_emitChanged","_remove","invalidateIndex","forEachInBounds","emit","getLogger","feature","displayId","onFeatureAdd","onFeatureRemove"],"mappings":"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","file":"js/chunk-17a84624.4da8d134.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import{all as t}from\"../../../../core/promiseUtils.js\";import{WGS84 as i}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getJsonType as s,isPoint as r}from\"../../../../geometry/support/jsonUtils.js\";import{getFieldDefaultValue as n}from\"../../../support/fieldUtils.js\";import{kebabDict as a}from\"../../../support/fieldType.js\";import{convertFromFeatures as l,convertToFeature as o,convertFromFeature as d}from\"../../featureConversionUtils.js\";import u from\"../../../support/FieldsIndex.js\";import{checkProjectionSupport as p,project as f}from\"../../data/projectionSupport.js\";import{createDefaultAttributesFunction as y,createDrawingInfo as c,createDefaultTemplate as m}from\"./clientSideDefaults.js\";import h from\"../../data/FeatureStore.js\";import g from\"../../data/QueryEngine.js\";import{loadGeometryEngineForSimplify as I,createFeatureEditErrorResult as b,mixAttributes as F,createFeatureEditSuccessResult as _,simplify as j}from\"./sourceUtils.js\";const E=i,x={xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:i},T={hasAttachments:!1,capabilities:\"query, editing, create, delete, update\",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};function q(e){return r(e)?null!=e.z:!!e.hasZ}function R(e){return r(e)?null!=e.m:!!e.hasM}export default class{constructor(){this._queryEngine=null,this._nextObjectId=null}destroy(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null}async load(t){const i=[],{features:s}=t,r=this._inferLayerProperties(s,t.fields),l=t.fields||[],o=null!=t.hasM?t.hasM:r.hasM,d=null!=t.hasZ?t.hasZ:r.hasZ,f=!t.spatialReference&&!r.spatialReference,I=f?E:t.spatialReference||r.spatialReference,b=f?x:null,F=t.geometryType||r.geometryType,_=!F;let j=t.objectIdField||r.objectIdField,q=t.timeInfo;if(!_&&(f&&i.push({name:\"feature-layer:spatial-reference-not-found\",message:\"Spatial reference not provided or found in features. Defaults to WGS84\"}),!F))throw new e(\"feature-layer:missing-property\",\"geometryType not set and couldn't be inferred from the provided features\");if(!j)throw new e(\"feature-layer:missing-property\",\"objectIdField not set and couldn't be found in the provided fields\");if(r.objectIdField&&j!==r.objectIdField&&(i.push({name:\"feature-layer:duplicated-oid-field\",message:`Provided objectIdField \"${j}\" doesn't match the field name \"${r.objectIdField}\", found in the provided fields`}),j=r.objectIdField),j&&!r.objectIdField){let e=null;l.some((t=>t.name===j&&(e=t,!0)))?(e.type=\"esriFieldTypeOID\",e.editable=!1,e.nullable=!1):l.unshift({alias:j,name:j,type:\"esriFieldTypeOID\",editable:!1,nullable:!1})}for(const t of l){if(null==t.name&&(t.name=t.alias),null==t.alias&&(t.alias=t.name),!t.name)throw new e(\"feature-layer:invalid-field-name\",\"field name is missing\",{field:t});if(t.name===j&&(t.type=\"esriFieldTypeOID\"),-1===a.jsonValues.indexOf(t.type))throw new e(\"feature-layer:invalid-field-type\",`invalid type for field \"${t.name}\"`,{field:t})}const R={};this._requiredFields=[];for(const e of l)if(\"esriFieldTypeOID\"!==e.type&&\"esriFieldTypeGlobalID\"!==e.type){e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable;const t=n(e);e.nullable||void 0!==t?R[e.name]=t:this._requiredFields.push(e)}if(this._fieldsIndex=new u(l),this._createDefaultAttributes=y(R,j),q){if(q.startTimeField){const e=this._fieldsIndex.get(q.startTimeField);e?(q.startTimeField=e.name,e.type=\"esriFieldTypeDate\"):q.startTimeField=null}if(q.endTimeField){const e=this._fieldsIndex.get(q.endTimeField);e?(q.endTimeField=e.name,e.type=\"esriFieldTypeDate\"):q.endTimeField=null}if(q.trackIdField){const e=this._fieldsIndex.get(q.trackIdField);e?q.trackIdField=e.name:(q.trackIdField=null,i.push({name:\"feature-layer:invalid-timeInfo-trackIdField\",message:\"trackIdField is missing\",details:{timeInfo:q}}))}q.startTimeField||q.endTimeField||(i.push({name:\"feature-layer:invalid-timeInfo\",message:\"startTimeField and endTimeField are missing or invalid\",details:{timeInfo:q}}),q=null)}const D={warnings:i,featureErrors:[],layerDefinition:{...T,drawingInfo:c(F),templates:m(R),extent:b,geometryType:F,objectIdField:j,fields:l,hasZ:!!d,hasM:!!o,timeInfo:q},assignedObjectIds:{}};if(this._queryEngine=new g({fields:l,geometryType:F,hasM:o,hasZ:d,objectIdField:j,spatialReference:I,featureStore:new h({geometryType:F,hasM:o,hasZ:d}),timeInfo:q}),!s||!s.length)return this._nextObjectId=1,D;const O=s.reduce(((e,t)=>{const i=t.attributes&&t.attributes[j];return null==i||isNaN(i)||!isFinite(i)?e:Math.max(e,i)}),0);return this._nextObjectId=1+O,await p(s,I),this._loadInitialFeatures(D,s)}async applyEdits(e){const{spatialReference:i,geometryType:s}=this._queryEngine;return await t([I(i,s),p(e.adds,i),p(e.updates,i)]),this._applyEdits(e)}async queryFeatures(e,t={}){return this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e,t={}){return this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e,t={}){return this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e,t={}){return this._queryEngine.executeQueryForExtent(e,t.signal)}_inferLayerProperties(e,t){let i,r,n=null,a=null,l=null;for(const t of e){const e=t.geometry;if(e&&(n||(n=s(e)),a||(a=e.spatialReference),null==i&&(i=q(e)),null==r&&(r=R(e)),n&&a&&null!=i&&null!=r))break}if(t&&t.length){let e=null;t.some((t=>{const i=\"esriFieldTypeOID\"===t.type,s=!t.type&&t.name&&\"objectid\"===t.name.toLowerCase();return e=t,i||s}))&&(l=e.name)}return{geometryType:n,spatialReference:a,objectIdField:l,hasM:r,hasZ:i}}_loadInitialFeatures(e,t){const{geometryType:i,hasM:r,hasZ:n,objectIdField:a,spatialReference:o,featureStore:d}=this._queryEngine,u=[];for(const r of t){if(null!=r.uid&&(e.assignedObjectIds[r.uid]=-1),r.geometry&&i!==s(r.geometry)){e.featureErrors.push(b(\"Incorrect geometry type.\"));continue}const t=this._createDefaultAttributes(),n=F(this._fieldsIndex,this._requiredFields,t,r.attributes,!0,e.warnings);n?e.featureErrors.push(n):(this._assignObjectId(t,r.attributes,!0),r.attributes=t,null!=r.uid&&(e.assignedObjectIds[r.uid]=r.attributes[a]),r.geometry&&(r.geometry=f(r.geometry,r.geometry.spatialReference,o)),u.push(r))}if(d.addMany(l([],u,i,n,r,a)),e.layerDefinition.extent=this._queryEngine.fullExtent,e.layerDefinition.timeInfo){const{start:t,end:i}=this._queryEngine.timeExtent;e.layerDefinition.timeInfo.timeExtent=[t,i]}return e}_applyEdits(e){const{adds:t,updates:i,deletes:s}=e,r={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t&&t.length&&this._applyAddEdits(r,t),i&&i.length&&this._applyUpdateEdits(r,i),s&&s.length){for(const e of s)r.deleteResults.push(_(e));this._queryEngine.featureStore.removeManyById(s)}return{fullExtent:this._queryEngine.fullExtent,featureEditResults:r}}_applyAddEdits(e,t){const{addResults:i}=e,{geometryType:r,hasM:n,hasZ:a,objectIdField:o,spatialReference:d,featureStore:u}=this._queryEngine,p=[];for(const n of t){if(n.geometry&&r!==s(n.geometry)){i.push(b(\"Incorrect geometry type.\"));continue}const t=this._createDefaultAttributes(),a=F(this._fieldsIndex,this._requiredFields,t,n.attributes);if(a)i.push(a);else{if(this._assignObjectId(t,n.attributes),n.attributes=t,null!=n.uid){const t=n.attributes[o];e.uidToObjectId[n.uid]=t}n.geometry&&(n.geometry=f(j(n.geometry,d),n.geometry.spatialReference,d)),p.push(n),i.push(_(n.attributes[o]))}}u.addMany(l([],p,r,a,n,o))}_applyUpdateEdits({updateResults:e},t){const{geometryType:i,hasM:r,hasZ:n,objectIdField:a,spatialReference:l,featureStore:u}=this._queryEngine;for(const p of t){const{attributes:t,geometry:y}=p,c=t&&t[a];if(null==c){e.push(b(`Identifier field ${a} missing`));continue}if(!u.has(c)){e.push(b(`Feature with object id ${c} missing`));continue}const m=o(u.getFeature(c),i,n,r);if(y){if(i!==s(y)){e.push(b(\"Incorrect geometry type.\"));continue}m.geometry=f(j(y,l),y.spatialReference,l)}if(t){const i=F(this._fieldsIndex,this._requiredFields,m.attributes,t);if(i){e.push(i);continue}}u.add(d(m,i,n,r,a)),e.push(_(c))}}_assignObjectId(e,t,i=!1){const s=this._queryEngine.objectIdField;i&&t&&isFinite(t[s])?e[s]=t[s]:e[s]=this._nextObjectId++}}\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isValid as t}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{sanitizeNullFieldValue as e,validateFieldValue as n,validationErrorToString as i,isNumericField as r,isStringField as s}from\"../../../support/fieldUtils.js\";class o{constructor(){this.code=null,this.description=null}}class l{constructor(t){this.error=new o,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=t}}function u(t){return new l(t)}class a{constructor(t){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=t}}function c(t){return new a(t)}const f=new Set;function d(t,e,r,s,o=!1,l){f.clear();for(const e in s){const a=t.get(e);if(!a)continue;const c=s[e],d=m(a,c);if(d!==c&&l&&l.push({name:\"invalid-value-type\",message:\"attribute value was converted to match the field type\",details:{field:a,originalValue:c,sanitizedValue:d}}),f.add(a.name),a&&(o||a.editable)){const t=n(a,d);if(t)return u(i(t,a,d));r[a.name]=d}}for(const t of e)if(!f.has(t.name))return u(`missing required field \"${t.name}\"`);return null}function m(t,n){let i=n;return\"string\"==typeof n&&r(t)?i=parseFloat(n):null!=n&&s(t)&&\"string\"!=typeof n&&(i=String(n)),e(i)}let p;function h(e,n){if(!e||!t(n))return e;if(\"rings\"in e||\"paths\"in e){if(!p)throw new TypeError(\"geometry engine not loaded\");return p.simplify(n,e)}return e}async function g(){return p||(p=await import(\"../../../../geometry/geometryEngineJSON.js\"),p)}async function y(e,n){!t(e)||\"esriGeometryPolygon\"!==n&&\"esriGeometryPolyline\"!==n||await g()}export{u as createFeatureEditErrorResult,c as createFeatureEditSuccessResult,g as loadGeometryEngine,y as loadGeometryEngineForSimplify,d as mixAttributes,h as simplify};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport s from\"../../../core/has.js\";import{r as i}from\"../../../chunks/rbush.js\";const d={minX:0,minY:0,maxX:0,maxY:0};class n{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=i(9,s(\"csp-restrictions\")?s=>({minX:s[0],minY:s[1],maxX:s[2],maxY:s[3]}):[\"[0]\",\"[1]\",\"[2]\",\"[3]\"]),this._loadIndex=()=>{if(this._indexInvalid){const s=new Array(this._idByBounds.size);let i=0;this._idByBounds.forEach(((d,n)=>{s[i++]=n})),this._indexInvalid=!1,this._index.clear(),this._index.load(s)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter((s=>this._idByBounds.has(s)))),this._boundsToLoad.length=0)}}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(s){const i=this._boundsById.get(s);this._boundsById.delete(s),i&&(this._idByBounds.delete(i),this._indexInvalid||this._index.remove(i))}forEachInBounds(s,i){this._loadIndex();for(const n of function(s,i){return d.minX=i[0],d.minY=i[1],d.maxX=i[2],d.maxY=i[3],s.search(d)}(this._index,s))i(this._idByBounds.get(n))}get(s){return this._boundsById.get(s)}has(s){return this._boundsById.has(s)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(s,i){if(!this._indexInvalid){const i=this._boundsById.get(s);i&&(this._index.remove(i),this._idByBounds.delete(i))}this._boundsById.set(s,i),i&&(this._idByBounds.set(i,s),this._indexInvalid||(this._boundsToLoad.push(i),this._boundsToLoad.length>5e4&&this._loadIndex()))}}export{n as BoundsStore};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport t from\"../OptimizedFeature.js\";import e from\"../OptimizedGeometry.js\";import{getCentroidOptimizedGeometry as r}from\"../centroid.js\";const o={getObjectId:t=>t.objectId,getAttributes:t=>t.attributes,getAttribute:(t,e)=>t.attributes[e],cloneWithGeometry:(e,r)=>new t(r,e.attributes,null,e.objectId),getGeometry:t=>t.geometry,getCentroid:(t,o)=>(t.centroid||(t.centroid=r(new e,t.geometry,o.hasZ,o.hasM)),t.centroid)};export default o;export{o as optimizedFeatureQueryEngineAdapter};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import t from\"../../../core/Logger.js\";import r from\"../../../core/Error.js\";import s from\"../../../core/Evented.js\";import{create as o,NEGATIVE_INFINITY as i}from\"../../../geometry/support/aaBoundingRect.js\";import{getBoundsOptimizedGeometry as a}from\"../featureConversionUtils.js\";import{fromRect as d}from\"../../../geometry/support/aaBoundingBox.js\";import{BoundsStore as n}from\"./BoundsStore.js\";import{optimizedFeatureQueryEngineAdapter as h}from\"./optimizedFeatureQueryEngineAdapter.js\";export default class{constructor(e){this.geometryInfo=e,this._boundsStore=new n,this._featuresById=new Map,this._markedIds=new Set,this.events=new s,this.featureAdapter=h}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){if(!this.numFeatures)return null;const e=o(i);return this._featuresById.forEach((t=>{const r=this._boundsStore.get(t.objectId);r&&(e[0]=Math.min(r[0],e[0]),e[1]=Math.min(r[1],e[1]),e[2]=Math.max(r[2],e[2]),e[3]=Math.max(r[3],e[3]))})),e}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t,r){for(const s of e){const e=this._boundsStore.get(s.objectId);e&&t(d(r,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,r)=>{this._markedIds.has(r)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit(\"changed\",void 0)}_add(s){if(!s)return;const i=s.objectId;if(null==i)return void t.getLogger(\"esri.layers.graphics.data.FeatureStore\").error(new r(\"featurestore:invalid-feature\",\"feature id is missing\",{feature:s}));const d=this._featuresById.get(i);let n;if(this._markedIds.add(i),d?(s.displayId=d.displayId,n=this._boundsStore.get(i),this._boundsStore.delete(i)):e(this.onFeatureAdd)&&this.onFeatureAdd(s),!s.geometry||!s.geometry.coords||!s.geometry.coords.length)return this._boundsStore.set(i,null),void this._featuresById.set(i,s);n=a(n||o(),s.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(i,n),this._featuresById.set(i,s)}_remove(t){return e(this.onFeatureRemove)&&this.onFeatureRemove(t),this._markedIds.delete(t.objectId),this._boundsStore.delete(t.objectId),this._featuresById.delete(t.objectId),t}}\n"],"sourceRoot":""}